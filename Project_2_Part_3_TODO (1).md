# –ü—Ä–æ–µ–∫—Ç 2. –ß–∞—Å—Ç—å 3: –ö–∞—Å—Ç–æ–º–Ω—ã–µ –æ—à–∏–±–∫–∏ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

## –û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏

–†–∞—Å—à–∏—Ä—å –ø—Ä–æ–µ–∫—Ç –∏–∑ –ß–∞—Å—Ç–∏ 2, –¥–æ–±–∞–≤–∏–≤ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ —á–µ—Ä–µ–∑ –∫–∞—Å—Ç–æ–º–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è –∏ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Å –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–º–∏ –º–µ—Ç—Ä–∏–∫–∞–º–∏.

**–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–µ —É—Å–ª–æ–≤–∏–µ:** –í—ã–ø–æ–ª–Ω–µ–Ω–∞ –ß–∞—Å—Ç—å 2

## –¶–µ–ª—å

–û—Å–≤–æ–∏—Ç—å –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ —á–µ—Ä–µ–∑ exception handlers, —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏, –∑–∞–∫—Ä–µ–ø–∏—Ç—å –ø—Ä–∏–Ω—Ü–∏–ø—ã —á–∏—Å—Ç–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã.

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

### –í–ê–ñ–ù–û! –°—Ç—Ä–æ–≥–æ –ø—Ä–∏–¥–µ—Ä–∂–∏–≤–∞–π—Å—è —ç—Ç–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–ª—è –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è –∞–≤—Ç–æ—Ç–µ—Å—Ç–æ–≤!

```
project_root/
‚îú‚îÄ‚îÄ habit_tracker/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ habits_api.py           # –î–æ–±–∞–≤–ª–µ–Ω —ç–Ω–¥–ø–æ–∏–Ω—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ core/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ exceptions.py           # –ù–û–í–´–ô —Ñ–∞–π–ª —Å –∏—Å–∫–ª—é—á–µ–Ω–∏—è–º–∏!
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ models.py               # –î–æ–±–∞–≤–ª–µ–Ω–∞ –º–æ–¥–µ–ª—å HabitStatsResponse
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ services.py             # –î–æ–±–∞–≤–ª–µ–Ω—ã —Ñ—É–Ω–∫—Ü–∏–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏ –∑–∞–º–µ–Ω–µ–Ω—ã ValueError –Ω–∞ –∫–∞—Å—Ç–æ–º–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ views/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ web.py                  # –î–æ–±–∞–≤–ª–µ–Ω –º–∞—Ä—à—Ä—É—Ç /stats/
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ templates/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ index.html
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ habit_detail.html
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ stats.html              # –ù–û–í–´–ô —à–∞–±–ª–æ–Ω —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏!
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ static/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ css/style.css           # –û–±–Ω–æ–≤–ª—ë–Ω (–¥–æ–±–∞–≤–ª–µ–Ω—ã —Å—Ç–∏–ª–∏ –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ js/script.js
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ main.py                     # –î–æ–±–∞–≤–ª–µ–Ω—ã exception handlers!
‚îÇ
‚îú‚îÄ‚îÄ requirements.txt
‚îî‚îÄ‚îÄ README.md
```

## –ò–∑–º–µ–Ω–µ–Ω–∏—è –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –ß–∞—Å—Ç–∏ 2

### 1. –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã

–ü—Ä–æ–µ–∫—Ç –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã:
- `habit_tracker/core/exceptions.py` ‚Äî –∫–∞—Å—Ç–æ–º–Ω—ã–µ HTTP-–∏—Å–∫–ª—é—á–µ–Ω–∏—è
- `habit_tracker/templates/stats.html` ‚Äî —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

### 2. –û–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ñ–∞–π–ª–æ–≤

- `habit_tracker/core/services.py` ‚Äî –∑–∞–º–µ–Ω–µ–Ω—ã `ValueError` –Ω–∞ –∫–∞—Å—Ç–æ–º–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è, –¥–æ–±–∞–≤–ª–µ–Ω—ã —Ñ—É–Ω–∫—Ü–∏–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
- `habit_tracker/core/models.py` ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω–∞ –º–æ–¥–µ–ª—å `HabitStatsResponse`
- `habit_tracker/api/habits_api.py` ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω —ç–Ω–¥–ø–æ–∏–Ω—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
- `habit_tracker/views/web.py` ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω –º–∞—Ä—à—Ä—É—Ç `/stats/`
- `habit_tracker/main.py` ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω—ã exception handlers
- `habit_tracker/static/css/style.css` ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω—ã —Å—Ç–∏–ª–∏ –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### 1. –§–∞–π–ª `habit_tracker/core/exceptions.py`

**–ó–∞–¥–∞—á–∞:** –°–æ–∑–¥–∞–π –∫–∞—Å—Ç–æ–º–Ω—ã–µ HTTP-–∏—Å–∫–ª—é—á–µ–Ω–∏—è –¥–ª—è —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫.

–ò—Å–∫–ª—é—á–µ–Ω–∏—è –Ω–∞—Å–ª–µ–¥—É—é—Ç—Å—è –æ—Ç `HTTPException` –∏–∑ FastAPI, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –∏—Ö —á–µ—Ä–µ–∑ exception handlers –∏ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ HTTP-—Å—Ç–∞—Ç—É—Å-–∫–æ–¥—ã.

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**

–°–æ–∑–¥–∞–π 4 –∫–ª–∞—Å—Å–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π, –∫–∞–∂–¥—ã–π –∏–∑ –∫–æ—Ç–æ—Ä—ã—Ö –Ω–∞—Å–ª–µ–¥—É–µ—Ç—Å—è –æ—Ç `HTTPException`:

- **`HabitNotFoundException`** ‚Äî –ø—Ä–∏–≤—ã—á–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞
  - –°—Ç–∞—Ç—É—Å-–∫–æ–¥: **404 Not Found**
  - –°–æ–æ–±—â–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `"Habit not found."`
  - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, –∫–æ–≥–¥–∞ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç—Å—è –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è –ø—Ä–∏–≤—ã—á–∫–∞

- **`HabitAlreadyMarkedTodayException`** ‚Äî –ø—Ä–∏–≤—ã—á–∫–∞ —É–∂–µ –æ—Ç–º–µ—á–µ–Ω–∞ —Å–µ–≥–æ–¥–Ω—è
  - –°—Ç–∞—Ç—É—Å-–∫–æ–¥: **409 Conflict** (–≤–∞–∂–Ω–æ: –Ω–µ 400!)
  - –°–æ–æ–±—â–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `"Habit already marked for today."`
  - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –æ—Ç–º–µ—Ç–∫–∏ –∑–∞ —Ç–µ–∫—É—â–∏–π –¥–µ–Ω—å

- **`HabitNameConflictException`** ‚Äî –¥—É–±–ª–∏–∫–∞—Ç –∏–º–µ–Ω–∏ –ø—Ä–∏–≤—ã—á–∫–∏
  - –°—Ç–∞—Ç—É—Å-–∫–æ–¥: **400 Bad Request**
  - –°–æ–æ–±—â–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `"Habit with this name already exists."`
  - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∏–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ø—Ä–∏–≤—ã—á–∫–∏ —Å —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –∏–º–µ–Ω–µ–º

- **`InvalidInputException`** ‚Äî –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –≤–≤–æ–¥
  - –°—Ç–∞—Ç—É—Å-–∫–æ–¥: **400 Bad Request**
  - –°–æ–æ–±—â–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `"Invalid input data."`
  - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ–±—â–∏—Ö –æ—à–∏–±–æ–∫ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—É—Å—Ç–æ–µ –∏–º—è)

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–ª–∞—Å—Å–æ–≤:**

–ö–∞–∂–¥—ã–π –∫–ª–∞—Å—Å –¥–æ–ª–∂–µ–Ω:
- –ù–∞—Å–ª–µ–¥–æ–≤–∞—Ç—å—Å—è –æ—Ç `HTTPException`
- –í `__init__` –≤—ã–∑—ã–≤–∞—Ç—å `super().__init__()` —Å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º `status_code` –∏ `detail`
- –ü—Ä–∏–Ω–∏–º–∞—Ç—å –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä `detail` –¥–ª—è –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–µ

**–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –∏–º–µ–Ω–∞ –∫–ª–∞—Å—Å–æ–≤:**
- `HabitNotFoundException`
- `HabitAlreadyMarkedTodayException`
- `HabitNameConflictException`
- `InvalidInputException`

### 2. –§–∞–π–ª `habit_tracker/main.py`

–î–æ–±–∞–≤—å —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ —á–µ—Ä–µ–∑ exception handlers.

Exception handlers –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞—é—Ç –∫–∞—Å—Ç–æ–º–Ω—ã–µ HTTP-–∏—Å–∫–ª—é—á–µ–Ω–∏—è –∏ –∞–¥–∞–ø—Ç–∏—Ä—É—é—Ç –æ—Ç–≤–µ—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ –∑–∞–ø—Ä–æ—Å–∞ (JSON API –∏–ª–∏ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å).

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**

1. **–ò–º–ø–æ—Ä—Ç—ã:**
   - –ò–º–ø–æ—Ä—Ç–∏—Ä—É–π –∫–∞—Å—Ç–æ–º–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è –∏–∑ `habit_tracker.core.exceptions`
   - –ò–º–ø–æ—Ä—Ç–∏—Ä—É–π `Request` –∏–∑ `fastapi` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—É—Ç–∏ –∑–∞–ø—Ä–æ—Å–∞
   - –ò–º–ø–æ—Ä—Ç–∏—Ä—É–π `JSONResponse` –∏ `RedirectResponse` –∏–∑ `fastapi.responses`

2. **–°–æ–∑–¥–∞–π 4 exception handler'–∞:**

   –ö–∞–∂–¥—ã–π handler –¥–æ–ª–∂–µ–Ω:
   - –ü—Ä–æ–≤–µ—Ä—è—Ç—å, –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –ª–∏ –ø—É—Ç—å –∑–∞–ø—Ä–æ—Å–∞ —Å `/api` (—á–µ—Ä–µ–∑ `request.url.path.startswith("/api")`)
   - –î–ª—è API-–∑–∞–ø—Ä–æ—Å–æ–≤: –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å `JSONResponse` —Å `status_code` –∏–∑ –∏—Å–∫–ª—é—á–µ–Ω–∏—è –∏ `{"detail": exc.detail}`
   - –î–ª—è –≤–µ–±-–∑–∞–ø—Ä–æ—Å–æ–≤: –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å `RedirectResponse` –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º `error` –≤ URL (–Ω–∞–ø—Ä–∏–º–µ—Ä, `"/?error=..."` –∏–ª–∏ `"/habit/{habit_id}/?error=..."`)
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `status_code=303` (See Other) –¥–ª—è —Ä–µ–¥–∏—Ä–µ–∫—Ç–æ–≤

   **–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –∏–º–µ–Ω–∞ —Ö—ç–Ω–¥–ª–µ—Ä–æ–≤:**
   - `habit_not_found_exception_handler`
   - `habit_already_marked_today_exception_handler`
   - `habit_name_conflict_exception_handler`
   - `invalid_input_exception_handler`

   **–í–∞–∂–Ω–æ:**
   - –ö–æ–¥ –æ—à–∏–±–∫–∏ –±–µ—Ä—ë—Ç—Å—è –∏–∑ `exc.status_code` (—É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ —Å–∞–º–æ–º –∏—Å–∫–ª—é—á–µ–Ω–∏–∏)
   - –î–ª—è –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –∏—Å–ø–æ–ª—å–∑—É–π `status_code=303` –ø—Ä–∏ —Ä–µ–¥–∏—Ä–µ–∫—Ç–µ
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—É—Ç–∏: `request.url.path.startswith("/api")`

### 3. –§–∞–π–ª `habit_tracker/core/services.py`

–ó–∞–º–µ–Ω–∏ `ValueError` –Ω–∞ –∫–∞—Å—Ç–æ–º–Ω—ã–µ HTTP-–∏—Å–∫–ª—é—á–µ–Ω–∏—è –∏ –¥–æ–±–∞–≤—å —Ñ—É–Ω–∫—Ü–∏–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏.

#### 3.1. –ó–∞–º–µ–Ω–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π

**–ò–º–ø–æ—Ä—Ç—ã:**
- –ò–º–ø–æ—Ä—Ç–∏—Ä—É–π –≤—Å–µ 4 –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –∏—Å–∫–ª—é—á–µ–Ω–∏—è –∏–∑ `habit_tracker.core.exceptions`

**–ó–∞–º–µ–Ω–∏ –≤—ã–∑–æ–≤—ã –∏—Å–∫–ª—é—á–µ–Ω–∏–π –≤–æ –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏—è—Ö:**
- `raise ValueError("Habit not found")` -> `raise HabitNotFoundException()`
- `raise ValueError("...already exists")` -> `raise HabitNameConflictException()`
- `raise ValueError("...already marked")` -> `raise HabitAlreadyMarkedTodayException()`
- `raise ValueError("...")` –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ -> `raise InvalidInputException(detail="...")`

**–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤ `services.py`:**

–í –º–æ–¥—É–ª–µ `habit_tracker/core/services.py` –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –∫–∞—Å—Ç–æ–º–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è:

- **`get_habit_by_id(habit_id: int) -> Habit`**
  - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—Ä–∏–≤—ã—á–∫—É –ø–æ ID
  - –ï—Å–ª–∏ –ø—Ä–∏–≤—ã—á–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞, –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç `HabitNotFoundException` (–Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `None`!)

- **`mark_habit_completed(habit_id: int) -> Habit`**
  - –û—Ç–º–µ—á–∞–µ—Ç –ø—Ä–∏–≤—ã—á–∫—É –∑–∞ —Ç–µ–∫—É—â–∏–π –¥–µ–Ω—å
  - –ï—Å–ª–∏ –ø—Ä–∏–≤—ã—á–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞, –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç `HabitNotFoundException`
  - –ï—Å–ª–∏ –ø—Ä–∏–≤—ã—á–∫–∞ —É–∂–µ –æ—Ç–º–µ—á–µ–Ω–∞ —Å–µ–≥–æ–¥–Ω—è, –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç `HabitAlreadyMarkedTodayException` (–Ω–µ `ValueError`!)

- **`get_all_habits() -> list[Habit]`**
  - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø—Ä–∏–≤—ã—á–µ–∫
  - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –º–∞—Ä—à—Ä—É—Ç–µ `/stats/` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –≤—Å–µ—Ö –ø—Ä–∏–≤—ã—á–µ–∫

- **`create_habit(habit_data: HabitCreate) -> Habit`**
  - –°–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—É—é –ø—Ä–∏–≤—ã—á–∫—É
  - –ï—Å–ª–∏ –∏–º—è –ø—É—Å—Ç–æ–µ, –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç `InvalidInputException`
  - –ï—Å–ª–∏ –∏–º—è —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç `HabitNameConflictException`

- **`update_habit(habit_id: int, habit_data: HabitUpdate) -> Habit`**
  - –û–±–Ω–æ–≤–ª—è–µ—Ç –ø—Ä–∏–≤—ã—á–∫—É
  - –ï—Å–ª–∏ –ø—Ä–∏–≤—ã—á–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞, –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç `HabitNotFoundException`
  - –ï—Å–ª–∏ –∏–º—è –ø—É—Å—Ç–æ–µ, –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç `InvalidInputException`
  - –ï—Å–ª–∏ –∏–º—è —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç `HabitNameConflictException`

- **`delete_habit(habit_id: int) -> None`**
  - –£–¥–∞–ª—è–µ—Ç –ø—Ä–∏–≤—ã—á–∫—É
  - –ï—Å–ª–∏ –ø—Ä–∏–≤—ã—á–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞, –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç `HabitNotFoundException`

**–í–∞–∂–Ω–æ:** 
- –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ —Ä–∞–Ω—å—à–µ –≤–æ–∑–≤—Ä–∞—â–∞–ª–∏ `None` –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –ø—Ä–∏–≤—ã—á–∫–∏, —Ç–µ–ø–µ—Ä—å –¥–æ–ª–∂–Ω—ã –≤—ã–±—Ä–∞—Å—ã–≤–∞—Ç—å `HabitNotFoundException`.
- –ï—Å–ª–∏ –≤ Part 2 —É —Ç–µ–±—è –±—ã–ª–∏ —Ñ—É–Ω–∫—Ü–∏–∏ —Å –¥—Ä—É–≥–∏–º–∏ –∏–º–µ–Ω–∞–º–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `get_habit_by_id_with_details`, `mark_habit`), —Ç—ã –º–æ–∂–µ—à—å –ª–∏–±–æ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å –∏—Ö, –ª–∏–±–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Å —Ç—Ä–µ–±—É–µ–º—ã–º–∏ –∏–º–µ–Ω–∞–º–∏.

#### 3.2. –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

**`calculate_max_streak(marks: list[date]) -> int`**

–†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π streak (—Å–µ—Ä–∏—é –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö –¥–Ω–µ–π) –∑–∞ –≤—Å—ë –≤—Ä–µ–º—è –ø–æ —Å–ø–∏—Å–∫—É –¥–∞—Ç.

**–ê–ª–≥–æ—Ä–∏—Ç–º:**
- –ï—Å–ª–∏ `marks` –ø—É—Å—Ç–æ–π -> –≤–µ—Ä–Ω—É—Ç—å `0`
- –°–æ–∑–¥–∞—Ç—å –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —É–Ω–∏–∫–∞–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫ –¥–∞—Ç (–ø–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é)
- –ü—Ä–æ–π—Ç–∏ –ø–æ –¥–∞—Ç–∞–º –∏ —Å—á–∏—Ç–∞—Ç—å –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ –¥–Ω–∏:
  - –ï—Å–ª–∏ —Ä–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É —Ç–µ–∫—É—â–µ–π –∏ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –¥–∞—Ç–æ–π = 1 –¥–µ–Ω—å -> —É–≤–µ–ª–∏—á–∏—Ç—å —Ç–µ–∫—É—â–∏–π streak
  - –ò–Ω–∞—á–µ -> —Å–±—Ä–æ—Å–∏—Ç—å —Ç–µ–∫—É—â–∏–π streak –∏ –Ω–∞—á–∞—Ç—å –Ω–æ–≤—ã–π
- –í–µ—Ä–Ω—É—Ç—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ streak, –∫–æ—Ç–æ—Ä–æ–µ –±—ã–ª–æ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–æ

**–ü—Ä–∏–º–µ—Ä:**
```python
marks = [date(2025, 1, 1), date(2025, 1, 2), date(2025, 1, 5), date(2025, 1, 6)]
# max_streak = 2 (—Å–µ—Ä–∏—è –∏–∑ 1-2 —è–Ω–≤–∞—Ä—è –∏ —Å–µ—Ä–∏—è –∏–∑ 5-6 —è–Ω–≤–∞—Ä—è)
```

**`calculate_habit_stats(habit: Habit) -> dict`**

–†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –ø–æ–ª–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –ø—Ä–∏–≤—ã—á–∫–µ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ª–æ–≤–∞—Ä—å —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏.

**–í–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–π —Å–ª–æ–≤–∞—Ä—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å:**
- `total_marks: int` ‚Äî –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–º–µ—Ç–æ–∫ (`len(habit.marks)`)
- `current_streak: int` ‚Äî —Ç–µ–∫—É—â–∏–π streak (–∏—Å–ø–æ–ª—å–∑—É–π —Ñ—É–Ω–∫—Ü–∏—é `calculate_streak()` –∏–∑ Part 2)
- `max_streak: int` ‚Äî –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π streak –∑–∞ –≤—Å—ë –≤—Ä–µ–º—è (–∏—Å–ø–æ–ª—å–∑—É–π `calculate_max_streak()`)
- `success_rate: float` ‚Äî –ø—Ä–æ—Ü–µ–Ω—Ç —É—Å–ø–µ—à–Ω—ã—Ö –¥–Ω–µ–π (–æ—Ç 0.0 –¥–æ 100.0, –Ω–µ –æ—Ç 0 –¥–æ 1!)
  - –§–æ—Ä–º—É–ª–∞: `(total_marks / days_since_start) * 100`
  - `days_since_start` = –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π –æ—Ç –ø–µ—Ä–≤–æ–π –æ—Ç–º–µ—Ç–∫–∏ –¥–æ —Å–µ–≥–æ–¥–Ω—è (–≤–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ)
  - –ï—Å–ª–∏ `marks` –ø—É—Å—Ç–æ–π ‚Üí `success_rate = 0.0`
  - **–í–∞–∂–Ω–æ:** –†–µ–∑—É–ª—å—Ç–∞—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ [0.0, 100.0], –∞ –Ω–µ [0.0, 1.0]!
- `last_dates: list[date]` ‚Äî –ø–æ—Å–ª–µ–¥–Ω–∏–µ 5 –¥–∞—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (–æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ —É–±—ã–≤–∞–Ω–∏—é, –º–∞–∫—Å–∏–º—É–º 5 —ç–ª–µ–º–µ–Ω—Ç–æ–≤)

**–í–∞–∂–Ω–æ:**
- `success_rate` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —á–∏—Å–ª–æ–º (float), –æ–∫—Ä—É–≥–ª—ë–Ω–Ω—ã–º –¥–æ 2 –∑–Ω–∞–∫–æ–≤ –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π
- `last_dates` –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –æ–±—ä–µ–∫—Ç—ã `date`, –∞ –Ω–µ —Å—Ç—Ä–æ–∫–∏
- –ï—Å–ª–∏ –æ—Ç–º–µ—Ç–æ–∫ –º–µ–Ω—å—à–µ 5, –≤–µ—Ä–Ω–∏ –≤—Å–µ –∏–º–µ—é—â–∏–µ—Å—è –¥–∞—Ç—ã

### 4. –§–∞–π–ª `habit_tracker/core/models.py`

**–ó–∞–¥–∞—á–∞:** –î–æ–±–∞–≤—å –º–æ–¥–µ–ª—å –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø—Ä–∏–≤—ã—á–∫–∏.

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**

–°–æ–∑–¥–∞–π Pydantic-–º–æ–¥–µ–ª—å `HabitStatsResponse` —Å–æ —Å–ª–µ–¥—É—é—â–∏–º–∏ –ø–æ–ª—è–º–∏:
- `id: int` ‚Äî ID –ø—Ä–∏–≤—ã—á–∫–∏
- `name: str` ‚Äî –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–∏–≤—ã—á–∫–∏
- `total_marks: int` ‚Äî –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–º–µ—Ç–æ–∫
- `current_streak: int` ‚Äî —Ç–µ–∫—É—â–∏–π streak
- `max_streak: int` ‚Äî –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π streak
- `success_rate: float` ‚Äî –ø—Ä–æ—Ü–µ–Ω—Ç —É—Å–ø–µ—à–Ω—ã—Ö –¥–Ω–µ–π (0-100)
- `last_dates: list[date]` ‚Äî —Å–ø–∏—Å–æ–∫ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –¥–∞—Ç (–æ–±—ä–µ–∫—Ç—ã `date`)

**–í–∞–∂–Ω–æ:**
- –ú–æ–¥–µ–ª—å –¥–æ–ª–∂–Ω–∞ –Ω–∞–∑—ã–≤–∞—Ç—å—Å—è **`HabitStatsResponse`**
- –î–ª—è —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–∞—Ç –≤ JSON –∏—Å–ø–æ–ª—å–∑—É–π `json_encoders` –≤ `Config`:
  ```python
  class Config:
      json_encoders = {
          date: lambda v: v.isoformat()
      }
  ```

### 5. –§–∞–π–ª `habit_tracker/api/habits_api.py`

–î–æ–±–∞–≤—å —ç–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø—Ä–∏–≤—ã—á–∫–∏ —á–µ—Ä–µ–∑ JSON API.

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**

1. **–û–±–Ω–æ–≤–∏ –∏–º–ø–æ—Ä—Ç—ã:**
   - –ò–º–ø–æ—Ä—Ç–∏—Ä—É–π `HabitStatsResponse` –∏–∑ `habit_tracker.core.models`
   - –ò–º–ø–æ—Ä—Ç–∏—Ä—É–π —Ñ—É–Ω–∫—Ü–∏–∏ `get_habit_by_id` –∏ `calculate_habit_stats` –∏–∑ `habit_tracker.core.services`

2. **–î–æ–±–∞–≤—å —ç–Ω–¥–ø–æ–∏–Ω—Ç:**

   - –ü—É—Ç—å: `/{habit_id}/stats/` (—Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º —Ä–æ—É—Ç–µ—Ä–∞ –±—É–¥–µ—Ç `/api/habits/{habit_id}/stats/`)
   - –ú–µ—Ç–æ–¥: `GET`
   - Response model: `HabitStatsResponse`
   - –§—É–Ω–∫—Ü–∏—è: `get_habit_stats(habit_id: int)`

   **–õ–æ–≥–∏–∫–∞:**
   - –ü–æ–ª—É—á–∏—Ç—å –ø—Ä–∏–≤—ã—á–∫—É —á–µ—Ä–µ–∑ `get_habit_by_id(habit_id)` ‚Äî —Ñ—É–Ω–∫—Ü–∏—è –≤—ã–±—Ä–æ—Å–∏—Ç `HabitNotFoundException`, –µ—Å–ª–∏ –ø—Ä–∏–≤—ã—á–∫–∏ –Ω–µ—Ç
   - –†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —á–µ—Ä–µ–∑ `calculate_habit_stats(habit)`
   - –í–µ—Ä–Ω—É—Ç—å `HabitStatsResponse` —Å `id` –∏ `name` –∏–∑ –ø—Ä–∏–≤—ã—á–∫–∏ –∏ –≤—Å–µ–º–∏ –º–µ—Ç—Ä–∏–∫–∞–º–∏ –∏–∑ —Å–ª–æ–≤–∞—Ä—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

   **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:**
   - –ï—Å–ª–∏ –ø—Ä–∏–≤—ã—á–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞, `get_habit_by_id` –≤—ã–±—Ä–æ—Å–∏—Ç `HabitNotFoundException`, –∫–æ—Ç–æ—Ä–æ–µ –±—É–¥–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ exception handler'–æ–º

### 6. –§–∞–π–ª `habit_tracker/views/web.py`

–î–æ–±–∞–≤—å –º–∞—Ä—à—Ä—É—Ç –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –≤—Å–µ—Ö –ø—Ä–∏–≤—ã—á–µ–∫.

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**

**–ú–∞—Ä—à—Ä—É—Ç:**
- –ü—É—Ç—å: `/stats/`
- –ú–µ—Ç–æ–¥: `GET`
- Response class: `HTMLResponse`
- Name: `"stats-page"` (–¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ `url_for()`)
- –§—É–Ω–∫—Ü–∏—è: `get_stats_page(request: Request)`

**–õ–æ–≥–∏–∫–∞:**
- –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –ø—Ä–∏–≤—ã—á–∫–∏ —á–µ—Ä–µ–∑ `get_all_habits()` –∏–∑ `habit_tracker.core.services`
- –î–ª—è –∫–∞–∂–¥–æ–π –ø—Ä–∏–≤—ã—á–∫–∏:
  - –†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —á–µ—Ä–µ–∑ `calculate_habit_stats(habit)` –∏–∑ `services`
  - –û–±—ä–µ–¥–∏–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏–≤—ã—á–∫–∏ (`id`, `name`) –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –≤ –æ–¥–∏–Ω —Å–ª–æ–≤–∞—Ä—å
- –ü–µ—Ä–µ–¥–∞—Ç—å —Å–ø–∏—Å–æ–∫ —Å–ª–æ–≤–∞—Ä–µ–π –≤ —à–∞–±–ª–æ–Ω `stats.html` –ø–æ–¥ –∫–ª—é—á–æ–º `stats`
- –í–µ—Ä–Ω—É—Ç—å `TemplateResponse` —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º `{"request": request, "stats": stats_data}`

**–í–∞–∂–Ω–æ:**
- –§—É–Ω–∫—Ü–∏—è `get_all_habits()` –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∞ –∏–∑ `habit_tracker.core.services`
- –§—É–Ω–∫—Ü–∏—è `calculate_habit_stats()` —Ç–∞–∫–∂–µ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∞ –∏–∑ `habit_tracker.core.services`

### 7. –§–∞–π–ª `habit_tracker/templates/stats.html`

**–ó–∞–¥–∞—á–∞:** –°–æ–∑–¥–∞–π HTML-—Å—Ç—Ä–∞–Ω–∏—Ü—É —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏.

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**

–°–æ–∑–¥–∞–π —Ñ–∞–π–ª `stats.html` —Å–æ —Å–ª–µ–¥—É—é—â–∏–º —Å–æ–¥–µ—Ä–∂–∏–º—ã–º:

```html
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–∏–≤—ã—á–µ–∫</title>
    <link rel="stylesheet" href="{{ url_for('static', path='css/style.css') }}">
</head>
<body>
    <div class="container">
        <a href="/" class="back-link">&larr; –ù–∞–∑–∞–¥ –∫ –ø—Ä–∏–≤—ã—á–∫–∞–º</a>
        <h1>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–∏–≤—ã—á–µ–∫</h1>

        {% if stats %}
            <div class="stats-grid">
                {% for habit_stats in stats %}
                    <div class="habit-stats-card">
                        <h2>{{ habit_stats.name }}</h2>
                        <p><strong>–í—Å–µ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–π:</strong> {{ habit_stats.total_marks }}</p>
                        <p><strong>–¢–µ–∫—É—â–∏–π streak:</strong> {{ habit_stats.current_streak }} –¥–Ω.</p>
                        <p><strong>–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π streak:</strong> {{ habit_stats.max_streak }} –¥–Ω.</p>
                        <p><strong>–ü—Ä–æ—Ü–µ–Ω—Ç —É—Å–ø–µ—à–Ω—ã—Ö –¥–Ω–µ–π:</strong> {{ "%.1f"|format(habit_stats.success_rate) }}%</p>
                        <p><strong>–ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ—Ç–º–µ—Ç–∫–∏:</strong></p>
                        <ul class="last-marks-list">
                            {% for date in habit_stats.last_dates %}
                                <li>{{ date.strftime('%Y-%m-%d') }}</li>
                            {% else %}
                                <li>–ù–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –æ—Ç–º–µ—Ç–æ–∫</li>
                            {% endfor %}
                        </ul>
                        <p><a href="/habit/{{ habit_stats.id }}/" class="detail-link">–ü–æ–¥—Ä–æ–±–Ω–µ–µ –æ –ø—Ä–∏–≤—ã—á–∫–µ</a></p>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <p>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–∫–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞, –¥–æ–±–∞–≤—å—Ç–µ –ø—Ä–∏–≤—ã—á–∫–∏ –∏ –æ—Ç–º–µ—Ç—å—Ç–µ –∏—Ö –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ.</p>
        {% endif %}
    </div>
    <script src="{{ url_for('static', path='js/script.js') }}"></script>
</body>
</html>
```

**–í–∞–∂–Ω–æ:**
- –í —à–∞–±–ª–æ–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `stats` (—Å–ø–∏—Å–æ–∫ —Å–ª–æ–≤–∞—Ä–µ–π —Å–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π)
- –î–ª—è –∫–∞–∂–¥–æ–π –ø—Ä–∏–≤—ã—á–∫–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤—Å–µ –º–µ—Ç—Ä–∏–∫–∏ –∏–∑ `calculate_habit_stats()`
- –î–∞—Ç—ã —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ `strftime('%Y-%m-%d')`
- –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è CSS-–∫–ª–∞—Å—Å—ã –¥–ª—è —Å—Ç–∏–ª–∏–∑–∞—Ü–∏–∏ (`.stats-grid`, `.habit-stats-card`, `.last-marks-list`)

### 8. –§–∞–π–ª `habit_tracker/static/css/style.css`

**–ó–∞–¥–∞—á–∞:** –î–æ–±–∞–≤—å —Å—Ç–∏–ª–∏ –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏.

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**

–û–±–Ω–æ–≤–∏ —Ñ–∞–π–ª `style.css` —Å–ª–µ–¥—É—é—â–∏–º —Å–æ–¥–µ—Ä–∂–∏–º—ã–º:

```css
body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 20px;
    background-color: #f4f4f4;
    color: #333;
}

.container {
    max-width: 800px;
    margin: 30px auto;
    background-color: #fff;
    padding: 30px;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
}

h1, h2 {
    color: #333;
    text-align: center;
    margin-bottom: 25px;
}

.error-message {
    background-color: #ffe0e0;
    color: #cc0000;
    padding: 10px 15px;
    border: 1px solid #cc0000;
    border-radius: 5px;
    margin-bottom: 20px;
    text-align: center;
}

.back-link, .stats-link, .detail-link {
    display: inline-block;
    margin-bottom: 20px;
    color: #007bff;
    text-decoration: none;
}

.back-link:hover, .stats-link:hover, .detail-link:hover {
    text-decoration: underline;
}

.add-habit-form, .edit-habit-form {
    display: flex;
    margin-bottom: 20px;
    gap: 10px;
}

.add-habit-form input[type="text"],
.edit-habit-form input[type="text"] {
    flex-grow: 1;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 4px;
}

.add-habit-form button,
.edit-habit-form button,
.mark-button,
.delete-button {
    padding: 10px 15px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    background-color: #007bff;
    color: white;
}

.add-habit-form button:hover,
.edit-habit-form button:hover,
.mark-button:hover {
    background-color: #0056b3;
}

.habit-list {
    list-style: none;
    padding: 0;
}

.habit-item {
    background-color: #f9f9f9;
    border: 1px solid #eee;
    padding: 15px;
    margin-bottom: 10px;
    border-radius: 5px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.habit-link {
    text-decoration: none;
    color: #333;
    font-weight: bold;
    flex-grow: 1;
}

.habit-link:hover {
    color: #007bff;
}

.marked-today-message {
    color: #28a745;
    font-weight: bold;
    margin-left: 10px;
}

.delete-button {
    background-color: #dc3545;
}

.delete-button:hover {
    background-color: #c82333;
}

.marks-list {
    list-style: disc;
    margin-left: 20px;
    margin-bottom: 20px;
}

.habit-actions {
    margin-top: 30px;
    padding-top: 20px;
    border-top: 1px solid #eee;
}

/* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ */
.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 20px;
}

.habit-stats-card {
    background-color: #f9f9f9;
    border: 1px solid #eee;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 1px 5px rgba(0, 0, 0, 0.05);
}

.habit-stats-card h2 {
    margin-top: 0;
    margin-bottom: 15px;
    text-align: left;
    color: #007bff;
}

.habit-stats-card p {
    margin-bottom: 8px;
}

.habit-stats-card strong {
    color: #555;
}

.last-marks-list {
    list-style: disc;
    margin-left: 20px;
    margin-top: 10px;
    max-height: 100px; /* –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –≤—ã—Å–æ—Ç—É –¥–ª—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ */
    overflow-y: auto; /* –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–æ–∫—Ä—É—Ç–∫—É */
    padding-right: 10px;
}

.last-marks-list li {
    margin-bottom: 3px;
    color: #666;
}
```

–¢—ã –º–æ–∂–µ—à—å —Ä–∞—Å—à–∏—Ä—è—Ç—å —Å—Ç–∏–ª–∏ –ø–æ–¥ —Å–≤–æ–π –≤–∫—É—Å, –Ω–æ –Ω–µ —É–¥–∞–ª—è–π –∫–ª—é—á–µ–≤—ã–µ –∫–ª–∞—Å—Å—ã, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–µ –æ–ø–∏—Ä–∞–µ—Ç—Å—è —Ä–∞–∑–º–µ—Ç–∫–∞.

### 9. –û–±–Ω–æ–≤–∏—Ç—å –Ω–∞–≤–∏–≥–∞—Ü–∏—é

–î–æ–±–∞–≤—å —Å—Å—ã–ª–∫—É –Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —à–∞–±–ª–æ–Ω—ã.

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**

–û–±–Ω–æ–≤–∏ —Ñ–∞–π–ª `templates/index.html` —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:

```html
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢—Ä–µ–∫–µ—Ä –ø—Ä–∏–≤—ã—á–µ–∫</title>
    <link rel="stylesheet" href="{{ url_for('static', path='css/style.css') }}">
</head>
<body>
    <div class="container">
        <h1>–ú–æ–∏ –ø—Ä–∏–≤—ã—á–∫–∏</h1>

        {% if error %}
            <p class="error-message">{{ error }}</p>
        {% endif %}

        <form action="/habits" method="post" class="add-habit-form">
            <input type="text" name="name" placeholder="–ù–æ–≤–∞—è –ø—Ä–∏–≤—ã—á–∫–∞" required>
            <button type="submit">–î–æ–±–∞–≤–∏—Ç—å</button>
        </form>

        <ul class="habit-list">
            {% for habit in habits %}
                <li class="habit-item">
                    <a href="/habit/{{ habit.id }}/" class="habit-link">
                        {{ habit.name }} (Streak: {{ habit.streak }})
                    </a>
                    {% if not habit.marked_today %}
                        <form action="/habit/{{ habit.id }}/mark/" method="post" style="display: inline;">
                            <button type="submit" class="mark-button">–í—ã–ø–æ–ª–Ω–∏–ª —Å–µ–≥–æ–¥–Ω—è</button>
                        </form>
                    {% else %}
                        <span class="marked-today-message">–û—Ç–º–µ—á–µ–Ω–æ —Å–µ–≥–æ–¥–Ω—è!</span>
                    {% endif %}
                </li>
            {% else %}
                <p>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –ø—Ä–∏–≤—ã—á–µ–∫. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—É—é!</p>
            {% endfor %}
        </ul>

        <p><a href="/stats/" class="stats-link">–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É</a></p>
    </div>
    <script src="{{ url_for('static', path='js/script.js') }}"></script>
</body>
</html>
```

–ò–ª–∏ –ø—Ä–æ—Å—Ç–æ –¥–æ–±–∞–≤—å —Å—Å—ã–ª–∫—É —Ä—è–¥–æ–º —Å –¥—Ä—É–≥–∏–º–∏ —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏.

## API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã (–ø–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫)

### JSON API (–ø—Ä–µ—Ñ–∏–∫—Å `/api/habits`)

| –ú–µ—Ç–æ–¥ | –ü—É—Ç—å | –û–ø–∏—Å–∞–Ω–∏–µ | –°—Ç–∞—Ç—É—Å |
|-------|------|----------|--------|
| POST | `/api/habits/` | –°–æ–∑–¥–∞—Ç—å –ø—Ä–∏–≤—ã—á–∫—É | 201 |
| GET | `/api/habits/` | –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø—Ä–∏–≤—ã—á–µ–∫ | 200 |
| GET | `/api/habits/{id}/` | –ü–æ–ª—É—á–∏—Ç—å –æ–¥–Ω—É –ø—Ä–∏–≤—ã—á–∫—É | 200 |
| PUT | `/api/habits/{id}/` | –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–≤—ã—á–∫—É | 200 |
| DELETE | `/api/habits/{id}/` | –£–¥–∞–ª–∏—Ç—å –ø—Ä–∏–≤—ã—á–∫—É | 204 |
| POST | `/api/habits/{id}/mark/` | –û—Ç–º–µ—Ç–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ | 200 / **409** (–ø–æ–≤—Ç–æ—Ä–Ω–∞—è –æ—Ç–º–µ—Ç–∫–∞) |
| GET | `/api/habits/{id}/stats/` | **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–∏–≤—ã—á–∫–∏** | 200 |

### Web Interface

| –ú–µ—Ç–æ–¥ | –ü—É—Ç—å | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|------|----------|
| GET | `/` | –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ |
| GET | `/habit/{id}/` | –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ |
| GET | `/stats/` | **–°—Ç—Ä–∞–Ω–∏—Ü–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏** |

## –ü—Ä–∏–º–µ—Ä—ã API-–∑–∞–ø—Ä–æ—Å–æ–≤

### –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

**–ó–∞–ø—Ä–æ—Å:**
```http
GET /api/habits/1/stats/ HTTP/1.1
```

**–û—Ç–≤–µ—Ç (200 OK):**
```json
{
  "id": 1,
  "name": "–ë–µ–≥",
  "total_marks": 12,
  "current_streak": 5,
  "max_streak": 7,
  "success_rate": 83.33,
  "last_dates": [
    "2025-07-18",
    "2025-07-17",
    "2025-07-16",
    "2025-07-15",
    "2025-07-14"
  ]
}
```

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∫–æ–¥–∞ –æ—à–∏–±–∫–∏

**–í–ê–ñ–ù–û: –ö–æ–¥ –æ—à–∏–±–∫–∏ –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –æ—Ç–º–µ—Ç–∫–∏ –∏–∑–º–µ–Ω—ë–Ω —Å 400 –Ω–∞ 409!**

**–ó–∞–ø—Ä–æ—Å:**
```http
POST /api/habits/1/mark/ HTTP/1.1
```

**–û—Ç–≤–µ—Ç –µ—Å–ª–∏ —É–∂–µ –æ—Ç–º–µ—á–µ–Ω–æ (409 Conflict):**
```json
{
  "detail": "Habit already marked for today."
}
```

## –ß–µ–∫-–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ —Å–¥–∞—á–µ–π

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞
- [ ] –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `core/exceptions.py`
- [ ] –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `templates/stats.html`
- [ ] –û–±–Ω–æ–≤–ª—ë–Ω —Ñ–∞–π–ª `main.py` (–¥–æ–±–∞–≤–ª–µ–Ω—ã handlers)

### –ö–∞—Å—Ç–æ–º–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è
- [ ] –û–ø—Ä–µ–¥–µ–ª—ë–Ω –∫–ª–∞—Å—Å `HabitNotFoundException` (–Ω–∞—Å–ª–µ–¥—É–µ—Ç—Å—è –æ—Ç HTTPException, —Å—Ç–∞—Ç—É—Å 404)
- [ ] –û–ø—Ä–µ–¥–µ–ª—ë–Ω –∫–ª–∞—Å—Å `HabitAlreadyMarkedTodayException` (—Å—Ç–∞—Ç—É—Å 409)
- [ ] –û–ø—Ä–µ–¥–µ–ª—ë–Ω –∫–ª–∞—Å—Å `HabitNameConflictException` (—Å—Ç–∞—Ç—É—Å 400)
- [ ] –û–ø—Ä–µ–¥–µ–ª—ë–Ω –∫–ª–∞—Å—Å `InvalidInputException` (—Å—Ç–∞—Ç—É—Å 400)
- [ ] –í—Å–µ `ValueError` –≤ —Å–µ—Ä–≤–∏—Å–∞—Ö –∑–∞–º–µ–Ω–µ–Ω—ã –Ω–∞ –∫–∞—Å—Ç–æ–º–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è

### Exception Handlers
- [ ] –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω handler –¥–ª—è `HabitNotFoundException`
- [ ] –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω handler –¥–ª—è `HabitAlreadyMarkedTodayException`
- [ ] –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω handler –¥–ª—è `HabitNameConflictException`
- [ ] –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω handler –¥–ª—è `InvalidInputException`
- [ ] Handlers –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç JSON –¥–ª—è API (`/api/*`)
- [ ] Handlers –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç —Ä–µ–¥–∏—Ä–µ–∫—Ç –¥–ª—è –≤–µ–±
- [ ] –ö–æ–¥ –æ—à–∏–±–∫–∏ –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –æ—Ç–º–µ—Ç–∫–∏ **409** (–Ω–µ 400!)

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- [ ] –°–æ–∑–¥–∞–Ω–∞ –º–æ–¥–µ–ª—å `HabitStatsResponse` (–Ω–µ HabitStatistics!)
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `calculate_max_streak()`
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `calculate_habit_stats()`
- [ ] –≠–Ω–¥–ø–æ–∏–Ω—Ç `GET /api/habits/{id}/stats/` —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –ú–∞—Ä—à—Ä—É—Ç `GET /stats/` —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –ú–µ—Ç—Ä–∏–∫–∞ `total_marks` –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞
- [ ] –ú–µ—Ç—Ä–∏–∫–∞ `current_streak` –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞
- [ ] –ú–µ—Ç—Ä–∏–∫–∞ `max_streak` –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞
- [ ] –ú–µ—Ç—Ä–∏–∫–∞ `success_rate` –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ [0, 100]
- [ ] `last_dates` —Å–æ–¥–µ—Ä–∂–∏—Ç –¥–æ 5 –¥–∞—Ç

### –ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞
- [ ] PEP 8 —Å–æ–±–ª—é–¥—ë–Ω
- [ ] Type hints –≤–µ–∑–¥–µ
- [ ] Docstrings –¥–ª—è –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π
- [ ] –ù–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- [ ] Swagger –æ–±–Ω–æ–≤–ª—ë–Ω —Å –Ω–æ–≤—ã–º —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–º
- [ ] README –æ–±–Ω–æ–≤–ª—ë–Ω
